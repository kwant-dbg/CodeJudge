FROM ubuntu:20.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && \
    apt-get install -y g++ libhiredis-dev libpq-dev ca-certificates && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY main_nossl.cpp ./

# Build without SSL support - no sandbox for now
RUN g++ -std=c++17 -I/usr/include/postgresql/ \
    main_nossl.cpp \
    -o judge_service \
    -lhiredis -lpq -lstdc++fs

CMD ["./judge_service"]
